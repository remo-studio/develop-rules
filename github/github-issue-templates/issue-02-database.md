## 📋 信息收集项: 数据库架构信息

**优先级**: P0 (必填)
**截止日期**: _待设定_
**负责人**: @_待分配_

---

### ✅ 任务清单 (Task List)

- [ ] **2.1 数据库清单** - 列出所有数据库的基本信息 (负责人: @___)
- [ ] **2.2 数据库表规模** - 统计主要大表的规模 (负责人: @___)
- [ ] **2.3 数据库关系映射** - 绘制数据库间同步关系图 (负责人: @___)
- [ ] **2.4 数据库连接信息** - 确认 AWS 端访问能力 (负责人: @___)
- [ ] **2.5 数据库性能指标** - 收集当前性能数据 (负责人: @___)
- [ ] **2.6 备份与恢复策略** - 了解备份和恢复机制 (负责人: @___)

> **进度**: GitHub 会自动显示完成进度 (例如: 2/6 完成)

---

### 📝 填写指南

#### 2.1 数据库清单
- 数据库总数
- 每个数据库的详细信息: DB编号、名称、类型、版本、所属平台、业务功能、数据量

#### 2.2 数据库表规模
- 列出每个数据库中 TOP 5 最大的表
- 包含: 表名、行数、大小、增长速度、是否需要同步

#### 2.3 数据库关系映射
- 使用箭头表示当前的同步关系
- 标注同步方向和频率

#### 2.4 数据库连接信息
- 哪些数据库可以被 AWS 端直接访问
- 如果不能访问,说明原因(网络隔离/防火墙/权限等)

#### 2.5 数据库性能指标
- CPU 使用率、内存使用率
- IOPS、并发连接数
- 慢查询数量

#### 2.6 备份与恢复策略
- 备份频率、保留周期
- RTO (恢复时间目标)
- RPO (数据丢失容忍度)

---

### 💬 收集结果

**请在下方评论中填写收集到的信息**

#### 回复格式示例:

```markdown
### 2.1 数据库清单 - @username

**数据库总数**: 5 个

| DB编号 | 数据库名称 | 类型 | 版本 | 所属平台 | 主要业务功能 | 数据量(GB) |
|--------|-----------|------|------|---------|-------------|-----------|
| DB-1 | juren-prod | MySQL | 8.0.35 | AWS-Production | 用户&订单核心业务 | 500 GB |
| DB-2 | analytics-db | PostgreSQL | 14.5 | GCP-Analytics | 数据分析 | 1.2 TB |
| DB-3 | legacy-main | MySQL | 5.7.42 | IDC-Legacy | 遗留系统主库 | 300 GB |
| DB-4 | cache-db | Redis | 7.0 | AWS-Production | 缓存 | 10 GB |
| DB-5 | log-db | MongoDB | 6.0 | AWS-Production | 日志存储 | 800 GB |
```

```markdown
### 2.2 数据库表规模 - @username

**数据库: juren-prod (DB-1)**

| 表名 | 行数 | 大小(GB) | 增长速度 | 是否需要同步 |
|------|------|---------|---------|-------------|
| orders | 15,000,000 | 85 GB | 5万行/天 | ✅ 是 |
| users | 8,000,000 | 42 GB | 1万行/天 | ✅ 是 |
| transactions | 50,000,000 | 120 GB | 20万行/天 | ✅ 是 |
| products | 200,000 | 5 GB | 500行/天 | ✅ 是 |
| order_items | 45,000,000 | 60 GB | 15万行/天 | ✅ 是 |

**数据库: analytics-db (DB-2)**

| 表名 | 行数 | 大小(GB) | 增长速度 | 是否需要同步 |
|------|------|---------|---------|-------------|
| user_behavior | 200,000,000 | 450 GB | 100万行/天 | ❌ 否 |
| sales_summary | 5,000,000 | 80 GB | 2万行/天 | ❌ 否 |
| ... | ... | ... | ... | ... |
```

```markdown
### 2.3 数据库关系映射 - @username

**当前同步关系图**:

```
DB-1 (juren-prod @ AWS)
  ├─> 每15分钟 ─> DB-2 (analytics-db @ GCP)
  │                  同步表: orders, users, transactions
  │
  └─> 每小时 ─> DB-3 (legacy-main @ IDC)
                    同步表: orders (仅新订单)

DB-3 (legacy-main @ IDC)
  └─> 每天凌晨2点 ─> DB-1 (juren-prod @ AWS)
                          同步表: inventory (库存数据)
```

**说明**:
- DB-1 → DB-2: 使用 AWS DMS (Database Migration Service)
- DB-1 → DB-3: 使用自定义 PHP 脚本
- DB-3 → DB-1: 使用 Cron + Python 脚本
```

```markdown
### 2.4 数据库连接信息 - @username

**是否所有数据库都可以被 AWS 端直接访问**: ❌ 否

| 数据库 | AWS 端可访问 | 原因/说明 |
|--------|-------------|----------|
| DB-1 (juren-prod) | ✅ 是 | 同在 AWS VPC 内 |
| DB-2 (analytics-db) | ⚠️ 部分 | 通过 VPC Peering,需配置安全组 |
| DB-3 (legacy-main) | ❌ 否 | 位于 IDC,仅通过 VPN 访问 |
| DB-4 (cache-db) | ✅ 是 | 同在 AWS VPC 内 |
| DB-5 (log-db) | ✅ 是 | 同在 AWS VPC 内 |

**如果不能直接访问,原因是**:
- ✅ 网络隔离 (DB-3)
- ✅ 防火墙规则 (DB-3)
- ✅ 安全组限制 (DB-2)
- ⚠️ 权限不足 (部分只读权限)
```

```markdown
### 2.5 数据库性能指标 - @username

| 数据库名称 | CPU使用率(%) | 内存使用率(%) | IOPS | 并发连接数 | 慢查询数/天 |
|-----------|-------------|--------------|------|-----------|------------|
| juren-prod | 45-60 | 75 | 2000-5000 | 150-200 | 50-100 |
| analytics-db | 30-70 | 80 | 5000-15000 | 80-120 | 20-50 |
| legacy-main | 65-85 | 90 | 800-2000 | 100-150 | 200-500 ⚠️ |
| cache-db | 20-35 | 60 | - | 500-1000 | 0 |
| log-db | 25-40 | 70 | 1000-3000 | 50-80 | 5-10 |

**性能问题说明**:
- legacy-main 慢查询数量较高,需要优化
- legacy-main CPU 和内存使用率接近上限,有性能瓶颈
```

```markdown
### 2.6 备份与恢复策略 - @username

| 数据库 | 备份频率 | 保留周期 | RTO | RPO |
|--------|---------|---------|-----|-----|
| juren-prod | 每小时增量 + 每天全量 | 30 天 | 2 小时 | 1 小时 |
| analytics-db | 每天全量 | 14 天 | 8 小时 | 24 小时 |
| legacy-main | 每天凌晨全量 | 7 天 | 12 小时 | 24 小时 |
| cache-db | 无定期备份 | - | - | 可接受数据丢失 |
| log-db | 每周全量 | 30 天 | 24 小时 | 7 天 |

**备注**:
- juren-prod 使用 AWS RDS 自动备份
- analytics-db 使用 GCP Cloud SQL 自动备份
- legacy-main 使用自定义备份脚本,可靠性待提升
```

---

### 🔗 相关文档

- [信息收集清单完整模板](../../agents/task-0001/信息收集清单0001.md#2%EF%B8%8F%E2%83%A3-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9E%B6%E6%9E%84%E4%BF%A1%E6%81%AF--database-architecture-information)
- [需求文档](../../agents/task-0001/需求.md)

---

### 💡 提示

- 数据库性能指标可以从监控系统(CloudWatch/Cloud Monitoring)导出
- 同步关系图可以使用文本绘制,也可以上传图片
- 敏感信息(如密码、连接串)请勿直接贴在 Issue 中
- 完成填写后,请勾选上方对应的任务清单

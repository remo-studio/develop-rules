## 📋 信息收集项: 同步机制现状

**优先级**: P0 (必填)
**截止日期**: _待设定_
**负责人**: @_待分配_

---

### ✅ 任务清单 (Task List)

- [ ] **3.1 同步脚本清单** - 列出所有同步脚本 (负责人: @___)
- [ ] **3.2 同步方式** - 确认当前采用的同步方式 (负责人: @___)
- [ ] **3.3 同步延迟现状** - 统计同步延迟数据 (负责人: @___)
- [ ] **3.4 同步脚本部署位置** - 确认脚本运行位置 (负责人: @___)
- [ ] **3.5 同步失败处理** - 了解失败处理机制 (负责人: @___)
- [ ] **3.6 监控与告警** - 收集监控和告警配置 (负责人: @___)

---

### 📝 填写指南

#### 3.1 同步脚本清单
- 同步脚本总数
- 每个脚本的详细信息: 名称、源数据库、目标数据库、同步内容、执行频率、执行时长、最近失败次数

#### 3.2 同步方式
- 定时全量同步 (Full Sync)
- 定时增量同步 (Incremental Sync)
- 基于时间戳同步 (Timestamp-based)
- 基于事件触发 (Event-driven)

#### 3.3 同步延迟现状
- 平均同步延迟
- 最大同步延迟
- 业务可接受的最大延迟

#### 3.4 同步脚本部署位置
脚本运行在哪里: 源/目标数据库服务器、独立调度服务器、容器、云函数等

#### 3.5 同步失败处理
- 自动重试机制
- 告警通知
- 数据一致性校验

#### 3.6 监控与告警
- 监控工具
- 告警渠道

---

### 💬 收集结果

**请在下方评论中填写收集到的信息**

#### 回复格式示例:

```markdown
### 3.1 同步脚本清单 - @username

**同步脚本总数**: 8 个

| 脚本名称 | 源数据库 | 目标数据库 | 同步表/数据 | 执行频率 | 执行时长 | 最近失败次数 |
|---------|---------|-----------|-----------|---------|---------|-------------|
| sync_orders.sh | DB-1 (AWS) | DB-2 (GCP) | orders, order_items | 每15分钟 | 8-12分钟 | 5次/月 |
| sync_users.sh | DB-1 (AWS) | DB-2 (GCP) | users, user_profiles | 每15分钟 | 3-5分钟 | 2次/月 |
| sync_inventory.py | DB-3 (IDC) | DB-1 (AWS) | inventory | 每天凌晨2点 | 45-60分钟 | 10次/月 ⚠️ |
| sync_transactions.sh | DB-1 (AWS) | DB-3 (IDC) | transactions | 每小时 | 15-25分钟 | 8次/月 |
| sync_products.sh | DB-1 (AWS) | DB-2 (GCP) | products, categories | 每小时 | 2-3分钟 | 0次/月 |
| ... | ... | ... | ... | ... | ... | ... |

**问题脚本说明**:
- `sync_inventory.py`: 失败率较高,主要原因是 VPN 连接不稳定
- `sync_transactions.sh`: 数据量增长导致执行时间不断延长
```

```markdown
### 3.2 同步方式 - @username

**当前采用的同步方式**:

| 脚本名称 | 同步方式 | 说明 |
|---------|---------|------|
| sync_orders.sh | 定时增量同步 | 基于 updated_at 时间戳 |
| sync_users.sh | 定时增量同步 | 基于 updated_at 时间戳 |
| sync_inventory.py | 定时全量同步 | 每次全表扫描 ⚠️ |
| sync_transactions.sh | 定时增量同步 | 基于 transaction_id |
| sync_products.sh | 定时增量同步 | 基于 updated_at 时间戳 |

**备注**:
- 大部分脚本采用增量同步,基于时间戳字段
- sync_inventory.py 采用全量同步,性能问题严重,急需优化
```

```markdown
### 3.3 同步延迟现状 - @username

| 同步任务 | 平均延迟 | 最大延迟 | 业务可接受延迟 | 状态 |
|---------|---------|---------|--------------|------|
| orders 订单数据 | 18分钟 | 45分钟 | 15分钟 | ⚠️ 超标 |
| users 用户数据 | 20分钟 | 35分钟 | 30分钟 | ✅ 正常 |
| inventory 库存数据 | 24小时 | 36小时 | 1小时 | 🔴 严重超标 |
| transactions 交易数据 | 65分钟 | 120分钟 | 60分钟 | ⚠️ 超标 |
| products 商品数据 | 65分钟 | 90分钟 | 2小时 | ✅ 正常 |

**问题说明**:
- orders 订单数据: 高峰期经常超过可接受延迟
- inventory 库存数据: 严重超标,影响业务决策
- transactions 交易数据: 接近上限,需要优化
```

```markdown
### 3.4 同步脚本部署位置 - @username

| 脚本名称 | 部署位置 | 说明 |
|---------|---------|------|
| sync_orders.sh | AWS EC2 (独立调度服务器) | Cron 定时执行 |
| sync_users.sh | AWS EC2 (独立调度服务器) | Cron 定时执行 |
| sync_inventory.py | IDC 物理服务器 | Cron 定时执行 |
| sync_transactions.sh | AWS EC2 (独立调度服务器) | Cron 定时执行 |
| sync_products.sh | 源数据库服务器 (DB-1) | Cron 定时执行 |

**架构说明**:
- 大部分脚本运行在 AWS EC2 独立调度服务器上
- sync_inventory.py 运行在 IDC,因为需要访问 Legacy 系统
- 部分脚本直接在数据库服务器上运行(不推荐)
```

```markdown
### 3.5 同步失败处理 - @username

**同步失败时的处理机制**:

| 脚本名称 | 自动重试 | 告警通知 | 手动介入 | 一致性校验 |
|---------|---------|---------|---------|-----------|
| sync_orders.sh | ✅ 是(3次) | ✅ 邮件+Slack | 需要 | ❌ 无 |
| sync_users.sh | ✅ 是(3次) | ✅ 邮件 | 需要 | ❌ 无 |
| sync_inventory.py | ❌ 否 | ✅ 邮件 | 需要 | ✅ 有(简单校验) |
| sync_transactions.sh | ✅ 是(2次) | ⚠️ 仅邮件 | 需要 | ❌ 无 |
| sync_products.sh | ✅ 是(3次) | ✅ 邮件+Slack | 需要 | ❌ 无 |

**数据一致性校验**:
- 仅 sync_inventory.py 有简单的行数校验
- 其他脚本无一致性校验机制,存在数据不一致风险

**问题**:
- 缺乏统一的错误处理机制
- 缺乏完善的数据一致性校验
- 手动介入成本高
```

```markdown
### 3.6 监控与告警 - @username

**是否有同步任务监控**: ⚠️ 部分有

**监控工具**:
- CloudWatch (AWS 侧脚本)
- 自定义监控脚本 (IDC 侧)
- 无统一监控平台

**告警渠道**:
- ✅ 邮件 (所有脚本)
- ✅ Slack (部分脚本)
- ❌ 短信 (无)
- ❌ 钉钉/企业微信 (无)

**监控指标**:
- 脚本执行状态 (成功/失败)
- 执行时长
- 同步数据量
- ❌ 缺少: 数据延迟监控
- ❌ 缺少: 数据一致性监控

**问题**:
- 监控不统一,分散在不同系统
- 缺少关键指标监控
- 告警响应不及时
```

---

### 🔗 相关文档

- [信息收集清单完整模板](../../agents/task-0001/信息收集清单0001.md#3%EF%B8%8F%E2%83%A3-%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6%E7%8E%B0%E7%8A%B6--current-sync-mechanism-status)
- [需求文档](../../agents/task-0001/需求.md)

---

### 💡 提示

- 可以提供脚本代码示例或截图
- 标注出有问题的脚本
- 如果有监控仪表板,可以截图提供
- 完成填写后,请勾选上方对应的任务清单
